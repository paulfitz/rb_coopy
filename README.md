Factor out material in https://github.com/paulfitz/coopy/tree/master/src/ruby
